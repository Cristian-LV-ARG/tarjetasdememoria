<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Examen de autodiagn√≥stico PSP - Control de Accesos 2026</title>
    <style>
        :root {
            --primary: #2c3e50;
            --accent: #3498db;
            --success: #27ae60;
            --error: #c0392b;
            --light: #ecf0f1;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f4f6f7;
            color: #333;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Estilos del Contenedor Principal */
        .card {
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            padding: 30px;
            margin-bottom: 20px;
            min-height: 400px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        /* Encabezado */
        header {
            text-align: center;
            margin-bottom: 20px;
            border-bottom: 2px solid var(--light);
            padding-bottom: 15px;
        }

        h1 { font-size: 1.6rem; color: var(--primary); margin: 0 0 10px 0; }
        .subtitle { font-size: 1rem; color: #7f8c8d; margin-bottom: 5px; }
        .credits { font-size: 0.85rem; color: #95a5a6; margin-top: 10px; font-style: italic; }
        
        /* Barra de Progreso */
        .progress-container {
            background-color: #e0e0e0;
            height: 10px;
            border-radius: 5px;
            margin-bottom: 20px;
            overflow: hidden;
        }
        .progress-bar {
            height: 100%;
            background-color: var(--accent);
            width: 0%;
            transition: width 0.3s ease;
        }

        /* Preguntas y Opciones */
        .question-text {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 20px;
            color: var(--primary);
        }

        .options-grid {
            display: grid;
            gap: 10px;
        }

        .option-btn {
            background: white;
            border: 2px solid var(--light);
            padding: 15px;
            border-radius: 8px;
            text-align: left;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 1rem;
            position: relative;
        }

        .option-btn:hover:not(.disabled) {
            border-color: var(--accent);
            background-color: #f0f8ff;
        }

        /* Estados de respuesta */
        .option-btn.correct {
            border-color: var(--success);
            background-color: #d4edda;
            color: #155724;
        }

        .option-btn.incorrect {
            border-color: var(--error);
            background-color: #f8d7da;
            color: #721c24;
        }

        .disabled {
            pointer-events: none;
            opacity: 0.7;
        }

        /* Feedback Inmediato */
        .feedback-msg {
            margin-top: 15px;
            padding: 10px;
            border-radius: 5px;
            font-weight: bold;
            display: none;
        }

        /* Botones de Navegaci√≥n */
        .nav-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid var(--light);
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: background 0.3s;
        }

        .btn-prev { background-color: #95a5a6; color: white; }
        .btn-next { background-color: var(--primary); color: white; }
        .btn-reset { background-color: var(--error); color: white; }
        
        .btn:disabled {
            background-color: #bdc3c7;
            cursor: not-allowed;
        }

        /* Pantalla de Resultados */
        #results-screen {
            display: none;
        }

        .score-card {
            text-align: center;
            background: var(--light);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .score-big {
            font-size: 3rem;
            font-weight: bold;
            color: var(--primary);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            font-size: 0.9rem;
        }

        th, td {
            padding: 10px;
            border: 1px solid #ddd;
            text-align: left;
        }

        th { background-color: var(--primary); color: white; }
        
        .status-ok { color: var(--success); font-weight: bold; }
        .status-bad { color: var(--error); font-weight: bold; }

    </style>
</head>
<body>

    <header>
        <h1>Examen de autodiagn√≥stico PSP</h1>
        <div class="subtitle">Control de Accesos 2026</div>
        <div class="subtitle">Grupo de estudio CEPI CSO International</div>
        <div class="credits">
            Autor: Jos√© Mar√≠a Piscione<br>
            Desarrollador: Cristian M
        </div>
    </header>

    <div id="quiz-screen" class="card">
        <div class="progress-container">
            <div class="progress-bar" id="progress-bar"></div>
        </div>
        
        <div class="header-info" style="display:flex; justify-content:space-between; color:#7f8c8d; font-size:0.9rem; margin-bottom:10px;">
            <span id="question-number">Pregunta 1 de 40</span>
            <span id="score-live">Aciertos: 0</span>
        </div>

        <div id="question-container">
            <div class="question-text" id="question-text">Cargando pregunta...</div>
            <div class="options-grid" id="options-container">
                </div>
            <div id="feedback" class="feedback-msg"></div>
        </div>

        <div class="nav-buttons">
            <div>
                <button class="btn btn-reset" onclick="resetQuiz()">Reiniciar Todo</button>
            </div>
            <div style="display:flex; gap:10px;">
                <button class="btn btn-prev" id="btn-prev" onclick="prevQuestion()" disabled>Anterior</button>
                <button class="btn btn-next" id="btn-next" onclick="nextQuestion()">Siguiente</button>
            </div>
        </div>
    </div>

    <div id="results-screen" class="card">
        <h2 style="text-align:center;">Reporte Final de Resultados</h2>
        <div class="score-card">
            <div>Tu Calificaci√≥n Final</div>
            <div class="score-big"><span id="final-score">0</span>%</div>
            <div id="final-stats">0 de 40 correctas</div>
        </div>

        <div id="detailed-report">
            </div>

        <button class="btn btn-reset" onclick="resetQuiz()" style="width:100%; margin-top:20px; padding: 15px;">üîÑ Reiniciar Examen</button>
    </div>

    <script>
        // --- BASE DE DATOS DE PREGUNTAS ---
        const questions = [
            {
                q: "1.- Dos formas de combatir autom√°ticamente el ir montado (‚Äúpiggy back‚Äù) y entrar colado despu√©s de la apertura del portal (‚Äútail gating‚Äú en un acceso, inmediatamente por detr√°s de quien lo hace habilitado con su debida credencial de control de acceso), son:",
                options: [
                    "a. Software de passback (no permite que alguien entre si ya est√° registrado como estando adentro, ni salir si a√∫n no ha entrado) y molinete √≥ptico",
                    "b. Trampas esclusas de punto de acceso y vigilancia de control de acceso",
                    "c. C√°maras de CCTV y sistemas de alarmas de intrusi√≥n",
                    "d. Software de anti-passback y molinete."
                ],
                correct: 3 // d
            },
            {
                q: "2.- Los sistemas de control de acceso se basan en considerar que la identificaci√≥n est√° dada por:",
                options: [
                    "a) Lo que una persona posee",
                    "b) Lo que una persona sabe",
                    "c) Una caracter√≠stica personal √∫nica de cada persona",
                    "d) Las tres opciones anteriores",
                    "e) Las opciones a y b"
                ],
                correct: 3 // d
            },
            {
                q: "3.- Las barreras determinan",
                options: [
                    "a. Frecuencia de ingresos y n√∫mero de canales.",
                    "b. Capacidad de procesamiento (de objetos, personas y/o veh√≠culos que desean ingresar), e identificaci√≥n del personal",
                    "c. N√∫mero de puestos e identificaci√≥n del personal",
                    "d. Distancia de apartamiento (enfrentamiento a la barrera) capacidad de procesamiento."
                ],
                correct: 3 // d
            },
            {
                q: "4.- Qu√© caracter√≠sticas deber√≠an tener en com√∫n un sistema de control de accesos y un sistema de control de presentismo?",
                options: [
                    "a) Utilizan los mismos paneles controladores",
                    "b) Utilizan los mismos lectores",
                    "c) Utilizan las mismas credenciales",
                    "d) Todas las anteriores"
                ],
                correct: 2 // c
            },
            {
                q: "5.- Qu√© sucede con el Indice de falso rechazo y el Indice de falsa aceptaci√≥n al aumentar el umbral de sensibilidad de un dispositivo biom√©trico?",
                options: [
                    "a) Ambos suben",
                    "b) El primero sube y el segundo baja",
                    "c) El primero baja y el segundo sube",
                    "d) No var√≠an"
                ],
                correct: 1 // b
            },
            {
                q: "6. Un portal de acceso es un punto de control que considera la integraci√≥n de :",
                options: [
                    "A. Puertas y Sistemas de Control de acceso",
                    "B. infraestructura f√≠sica",
                    "C. dispositivos de identificaci√≥n",
                    "D. procedimientos y personal",
                    "E. capacidad de procesamiento del flujo",
                    "F. todos los anteriores",
                    "G. todos menos uno de los anteriores"
                ],
                correct: 5 // F
            },
            {
                q: "7.- Desde la perspectiva de ingenier√≠a de accesos, ¬øqu√© determina un portal de acceso como sistema integrado (lector + autenticaci√≥n + autorizaci√≥n + barrera)?",
                options: [
                    "a. La frecuencia de uso y el dimensionamiento de los carriles de aproximaci√≥n",
                    "b. La capacidad de procesamiento del flujo y la modalidad de identificaci√≥n requerida",
                    "c. La cantidad de puestos de control y la asignaci√≥n de personal de vigilancia",
                    "d. La distancia de apartamiento y el tipo de barrera vehicular compatible"
                ],
                correct: 1 // b
            },
            {
                q: "8. ¬øCu√°l de las siguientes pr√°cticas es considerada una pol√≠tica sana de control de llaves?",
                options: [
                    "a. Entregar llaves maestras a contratistas de mantenimiento",
                    "b. Permitir la r√©plica de llaves bajo supervisi√≥n",
                    "c. Mantener registros estrictos de distribuci√≥n y devoluci√≥n",
                    "d. Utilizar combinaciones √∫nicas de gran maestro en todo el edificio"
                ],
                correct: 2 // c
            },
            {
                q: "9. ¬øC√≥mo se compensa el riesgo de las llaves maestras?",
                options: [
                    "A. Empleando submaestras",
                    "B. Minimizaci√≥n",
                    "C. Control estricto",
                    "D. Segmentaci√≥n",
                    "E. Llaves patentadas",
                    "F. Auditor√≠a",
                    "G. Recilindrado",
                    "H. Pol√≠ticas formales",
                    "I. Sustituci√≥n progresiva por control electr√≥nico",
                    "J. Todas las anteriores de la B a la I."
                ],
                correct: 9 // J
            },
            {
                q: "10. ¬øCu√°l es una limitaci√≥n operativa del pestillo el√©ctrico en puertas de salida de emergencia?",
                options: [
                    "a. No puede integrarse con lectores de tarjeta",
                    "b. Puede trabarse en la placa de tope si hay presi√≥n sobre la puerta",
                    "c. No admite modo fail-secure",
                    "d. No puede instalarse en marcos met√°licos"
                ],
                correct: 1 // b
            },
            {
                q: "11. ¬øQu√© distingue a la cerradura electromagn√©tica respecto de otras cerraduras el√©ctricas?",
                options: [
                    "a. No requiere energ√≠a para mantenerse cerrada",
                    "b. Su fuerza de retenci√≥n se mide en libras de tracci√≥n",
                    "c. No puede integrarse a sistemas de control de acceso",
                    "d. No puede instalarse en puertas de vidrio"
                ],
                correct: 1 // b
            },
            {
                q: "12. ¬øCu√°l de los atributos de identificaci√≥n es considerado m√°s dif√≠cil de vencer?",
                options: [
                    "a. Lo que la persona tiene",
                    "b. Lo que la persona sabe",
                    "c. Lo que la persona es o hace",
                    "d. Lo que la persona porta como documento f√≠sico"
                ],
                correct: 2 // c
            },
            {
                q: "13. ¬øCu√°l es una ventaja operativa del uso de PIN combinado con tarjeta?",
                options: [
                    "a. Reduce la necesidad de paneles",
                    "b. Permite eliminar la base de datos de usuarios",
                    "c. Incrementa la seguridad al agregar un segundo factor",
                    "d. Evita la necesidad de credenciales f√≠sicas"
                ],
                correct: 2 // c
            },
            {
                q: "14. ¬øCu√°l es el prop√≥sito principal del software anti-passback?",
                options: [
                    "a. Evitar que un usuario ingrese sin presentar credencial",
                    "b. Impedir el uso repetido de la misma credencial sin haber salido",
                    "c. Detectar tarjetas clonadas",
                    "d. Registrar la hora de ingreso y salida"
                ],
                correct: 1 // b
            },
            {
                q: "15. ¬øQu√© tipo de dispositivo de entrada puede dise√±arse mejor para ser m√°s preciso en evitar tailgating?",
                options: [
                    "a. Puertas oscilantes",
                    "b. Molinetes √≥pticos",
                    "c. Puertas giratorias",
                    "d. Vest√≠bulos"
                ],
                correct: 2 // c
            },
            {
                q: "16.-¬øCu√°l es el criterio para elegir entre fail-safe y fail-secure en el portal de un √°rea cr√≠tica que combina evacuaci√≥n y protecci√≥n de activos?",
                options: [
                    "a. Priorizar siempre fail-secure por seguridad patrimonial",
                    "b. Priorizar siempre fail-safe por seguridad humana",
                    "c. Determinar el modo seg√∫n el an√°lisis de riesgo y la funci√≥n primaria del portal",
                    "d. Elegir el modo seg√∫n el tipo de lector instalado"
                ],
                correct: 2 // c
            },
            {
                q: "17.¬øCu√°l es la limitaci√≥n cr√≠tica de las cerraduras electromagn√©ticas en puertas de salida?",
                options: [
                    "a. No pueden operar con bater√≠as",
                    "b. Requieren energ√≠a continua para mantenerse cerradas",
                    "c. No pueden integrarse con sensores de puerta",
                    "d. No permiten monitoreo de estado"
                ],
                correct: 1 // b
            },
            {
                q: "18. ¬øCu√°l es la debilidad estructural del atributo ‚Äúlo que la persona sabe‚Äù?",
                options: [
                    "a. No puede ser compartido",
                    "b. No puede ser observado",
                    "c. Es altamente transferible y susceptible a ingenier√≠a social",
                    "d. Requiere hardware especializado"
                ],
                correct: 2 // c
            },
            {
                q: "19. ¬øQu√© combinaci√≥n de factores ofrece el mayor nivel de resistencia ante ataques de pr√©stamo de credenciales?",
                options: [
                    "a. Tarjeta + PIN",
                    "b. Tarjeta + contrase√±a",
                    "c. Biometr√≠a + tarjeta",
                    "d. Biometr√≠a + PIN"
                ],
                correct: 3 // d
            },
            {
                q: "20. ¬øCu√°l es la raz√≥n por la que el anti-passback requiere sincronizaci√≥n precisa entre puntos de entrada y salida?",
                options: [
                    "a. Para evitar colas en los accesos",
                    "b. Para impedir que el sistema bloquee usuarios leg√≠timos",
                    "c. Para reducir el uso de memoria del panel",
                    "d. Para permitir auditor√≠as horarias"
                ],
                correct: 1 // b
            },
            {
                q: "21. ¬øCu√°l es el principio que justifica la instalaci√≥n de un vestibulo (mantrap/esclusa personal) en √°reas de muy alto riesgo?",
                options: [
                    "a. Reducir el tiempo de tr√°nsito",
                    "b. Permitir el ingreso simult√°neo de m√∫ltiples personas",
                    "c. Crear una barrera secuencial que permita verificaci√≥n redundante",
                    "d. Evitar la necesidad del uso de biometr√≠a"
                ],
                correct: 2 // c
            },
            {
                q: "22. Seg√∫n el enfoque de capas del Est√°ndar PAP, ¬øcu√°l es el error m√°s cr√≠tico al integrar control de acceso con CCTV?",
                options: [
                    "a. Usar c√°maras con demasiada resoluci√≥n",
                    "b. No alinear el evento de acceso con la evidencia visual en tiempo real",
                    "c. Instalar c√°maras en √°ngulos superiores a 45¬∞",
                    "d. No utilizar almacenamiento redundante"
                ],
                correct: 1 // b
            },
            {
                q: "23. ¬øCu√°l es el criterio para determinar si un punto debe tener autenticaci√≥n simple o m√∫ltiple?",
                options: [
                    "a. El costo del lector",
                    "b. La cantidad de usuarios",
                    "c. El nivel de riesgo asociado al activo protegido",
                    "d. La disponibilidad de biometr√≠a"
                ],
                correct: 2 // c
            },
            {
                q: "24. ¬øQu√© condici√≥n hace inapropiada una cerradura electromagn√©tica en un √°rea de contenci√≥n?",
                options: [
                    "a. Su fuerza de retenci√≥n",
                    "b. Su naturaleza fail-safe",
                    "c. Su compatibilidad con sensores",
                    "d. Su instalaci√≥n en marcos met√°licos"
                ],
                correct: 1 // b
            },
            {
                q: "25.- Un centro de datos de misi√≥n cr√≠tica tiene un flujo constante de t√©cnicos externos. La puerta principal est√° equipada con tarjeta + PIN, pero se detectaron m√∫ltiples incidentes donde un t√©cnico ingres√≥ con su tarjeta y luego permiti√≥ el ingreso de un colega sin credencial (‚Äúpiggybacking‚Äù). La gerencia quiere una soluci√≥n que reduzca el riesgo de ingreso no autorizado sin afectar la operaci√≥n continua.¬øQu√© medida es m√°s adecuada para este escenario?",
                options: [
                    "a. Reemplazar tarjeta + PIN por biometr√≠a obligatoria",
                    "b. Instalar un mantrap con control secuencial y sensores de presencia",
                    "c. Eliminar el PIN para acelerar el tr√°nsito",
                    "d. Implementar anti-passback estricto sin modificar la arquitectura f√≠sica"
                ],
                correct: 1 // b
            },
            {
                q: "26. ¬øQu√© dispositivo es m√°s adecuado para puertas de salida con alta presi√≥n de evacuaci√≥n?",
                options: [
                    "a. Cerradura electromagn√©tica certificada",
                    "b. Pestillo el√©ctrico certificado",
                    "c. Barra antip√°nico certificada",
                    "d. Cerradura de palanca reforzada certificada"
                ],
                correct: 2 // c
            },
            {
                q: "27. ¬øQu√© condici√≥n invalida el uso de fail-secure en una salida?",
                options: [
                    "a. Hard anti-passback",
                    "b. Requerimiento normativo de evacuaci√≥n inmediata",
                    "c. Presencia de CCTV",
                    "d. Uso de lectores en ambos lados del portal"
                ],
                correct: 1 // b
            },
            {
                q: "28. ¬øQu√© riesgo introduce una cerradura el√©ctrica mal integrada al sistema de incendio?",
                options: [
                    "a. Aumento del consumo energ√©tico",
                    "b. Apertura simult√°nea de todas las puertas",
                    "c. Bloqueo de evacuaci√≥n en caso de alarma",
                    "d. Activaci√≥n de alarmas falsa"
                ],
                correct: 2 // c
            },
            {
                q: "29. ¬øQu√© ventaja operativa tiene el uso de sensores de puerta en cerraduras el√©ctricas?",
                options: [
                    "a. Reducen el consumo energ√©tico",
                    "b. Permiten monitorear estado real de cierre",
                    "c. Eliminan la necesidad de paneles",
                    "d. Sustituyen al control de acceso"
                ],
                correct: 1 // b
            },
            {
                q: "30. ¬øQu√© condici√≥n invalida la autenticaci√≥n multifactor?",
                options: [
                    "A. Uso de dos factores del mismo tipo",
                    "B. Uso de biometr√≠a y tarjeta",
                    "C. Uso de PIN y contrase√±a",
                    "D. Uso de tarjeta y PIN"
                ],
                correct: 0 // A
            },
            {
                q: "31. ¬øQu√© riesgo aparece cuando se usa reconocimiento facial sin supervisi√≥n humana?",
                options: [
                    "a. Aumento del tiempo de tr√°nsito",
                    "b. Falsos positivos",
                    "c. Incompatibilidad con molinetes",
                    "d. Necesidad de iluminaci√≥n artificial"
                ],
                correct: 1 // b
            },
            {
                q: "32. ¬øQu√© funci√≥n cumple el ‚Äúestado l√≥gico‚Äù en control de acceso?",
                options: [
                    "A. Determinar el nivel de bater√≠a",
                    "B. Registrar la temperatura del lector",
                    "C. Controlar la fuerza del electroim√°n",
                    "D. Indicar si un usuario est√° dentro o fuera"
                ],
                correct: 3 // D
            },
            {
                q: "33. ¬øQu√© error cr√≠tico ocurre al integrar CCTV con control de acceso sin correlaci√≥n de eventos?",
                options: [
                    "a. Aumento del almacenamiento",
                    "b. P√©rdida de evidencia contextual",
                    "c. Reducci√≥n de la resoluci√≥n",
                    "d. Aumento del tiempo de respuesta"
                ],
                correct: 1 // b
            },
            {
                q: "34. ¬øQu√© capa del PAP se ve afectada si falla la autenticaci√≥n?",
                options: [
                    "a. Detecci√≥n",
                    "b. Disuasi√≥n",
                    "c. Demora",
                    "d. Respuesta"
                ],
                correct: 2 // c
            },
            {
                q: "35. ¬øQu√© condici√≥n invalida la capa de disuasi√≥n?",
                options: [
                    "a. Falta de se√±alizaci√≥n",
                    "b. Uso de c√°maras visibles",
                    "c. Uso de iluminaci√≥n perimetral",
                    "d. Presencia de guardia"
                ],
                correct: 0 // a
            },
            {
                q: "36. ¬øQu√© indicador sugiere riesgo de abuso de credenciales?",
                options: [
                    "a. Uso frecuente de PIN",
                    "b. Ingresos sin salida registrada",
                    "c. Uso de tarjetas RFID",
                    "d. Cambios de turno"
                ],
                correct: 1 // b
            },
            {
                q: "37. ¬øQu√© pol√≠tica reduce el riesgo de pr√©stamo de credenciales?",
                options: [
                    "a. Uso exclusivo de tarjetas",
                    "b. Autenticaci√≥n multifactor",
                    "c. Eliminaci√≥n de biometr√≠a",
                    "d. Uso de PIN compartidos"
                ],
                correct: 1 // b
            },
            {
                q: "38. ¬øQu√© riesgo aparece cuando un guardia controla manualmente un acceso sin registro electr√≥nico?",
                options: [
                    "A. Aumento del tiempo de tr√°nsito",
                    "B. Incompatibilidad con CCTV",
                    "C. Necesidad de iluminaci√≥n adicional",
                    "D. P√©rdida de trazabilidad"
                ],
                correct: 3 // D
            },
            {
                q: "39. ¬øCu√°l de los siguientes elementos no forma parte de la integraci√≥n funcional de un portal de acceso, aun cuando suele estar f√≠sicamente asociado a √©l?",
                options: [
                    "a. La infraestructura f√≠sica que soporta el portal",
                    "b. Los dispositivos de identificaci√≥n utilizados para autenticar usuarios",
                    "c. Los procedimientos operativos y el personal asignado",
                    "d. La capacidad de procesamiento del flujo de personas o veh√≠culos",
                    "e. La iluminaci√≥n perimetral del √°rea donde se encuentra el portal",
                    "f. Ninguno de los anteriores"
                ],
                correct: 4 // e
            },
            {
                q: "40. Desde la perspectiva de ingenier√≠a de accesos, ¬øcu√°l de los siguientes elementos es indispensable para que un portal de acceso funcione como un sistema integrado y no simplemente como un punto de paso, aun cuando todos los dem√°s elementos est√©n presentes?",
                options: [
                    "a. La infraestructura f√≠sica que soporta el montaje del portal",
                    "b. La existencia de procedimientos operativos y personal asignado",
                    "c. La capacidad de procesamiento del flujo en relaci√≥n con la modalidad de identificaci√≥n",
                    "d. La presencia de dispositivos de identificaci√≥n compatibles con el sistema",
                    "e. La instalaci√≥n de puertas y un sistema de control de acceso",
                    "f. Ninguno de los anteriores: todos son necesarios pero solo uno determina la integraci√≥n funcional"
                ],
                correct: 2 // c
            }
        ];

        // --- L√ìGICA DE LA APLICACI√ìN ---
        let currentQuestionIndex = 0;
        let userResponses = new Array(questions.length).fill(null); // Guarda indices seleccionados
        let score = 0;

        const quizScreen = document.getElementById('quiz-screen');
        const resultsScreen = document.getElementById('results-screen');
        const questionText = document.getElementById('question-text');
        const optionsContainer = document.getElementById('options-container');
        const feedbackDiv = document.getElementById('feedback');
        const btnNext = document.getElementById('btn-next');
        const btnPrev = document.getElementById('btn-prev');
        const progressBar = document.getElementById('progress-bar');
        const qNumberSpan = document.getElementById('question-number');
        const liveScoreSpan = document.getElementById('score-live');

        function loadQuestion(index) {
            const q = questions[index];
            questionText.textContent = q.q;
            qNumberSpan.textContent = `Pregunta ${index + 1} de ${questions.length}`;
            
            // Barra de progreso
            const progress = ((index + 1) / questions.length) * 100;
            progressBar.style.width = `${progress}%`;

            // Limpiar opciones
            optionsContainer.innerHTML = '';
            feedbackDiv.style.display = 'none';
            feedbackDiv.className = 'feedback-msg';

            // Generar botones de opciones
            q.options.forEach((opt, i) => {
                const btn = document.createElement('div');
                btn.className = 'option-btn';
                btn.textContent = opt;
                btn.onclick = () => selectOption(i);
                
                // Si ya fue respondida, restaurar estado
                if (userResponses[index] !== null) {
                    btn.classList.add('disabled');
                    if (i === q.correct) {
                        btn.classList.add('correct');
                    }
                    if (i === userResponses[index] && i !== q.correct) {
                        btn.classList.add('incorrect');
                    }
                }
                
                optionsContainer.appendChild(btn);
            });

            // Si ya fue respondida, mostrar feedback
            if (userResponses[index] !== null) {
                showFeedback(userResponses[index] === q.correct, q.options[q.correct]);
            }

            // Gestionar botones navegaci√≥n
            btnPrev.disabled = index === 0;
            if (index === questions.length - 1) {
                btnNext.textContent = "Ver Reporte Final";
                btnNext.onclick = finishQuiz;
            } else {
                btnNext.textContent = "Siguiente";
                btnNext.onclick = nextQuestion;
            }
        }

        function selectOption(selectedIndex) {
            // Prevenir cambio de respuesta
            if (userResponses[currentQuestionIndex] !== null) return;

            const q = questions[currentQuestionIndex];
            userResponses[currentQuestionIndex] = selectedIndex;
            
            // Actualizar puntaje
            if (selectedIndex === q.correct) {
                score++;
                updateLiveScore();
            }

            // Actualizar UI
            const buttons = optionsContainer.children;
            for (let i = 0; i < buttons.length; i++) {
                buttons[i].classList.add('disabled');
                if (i === q.correct) {
                    buttons[i].classList.add('correct');
                } else if (i === selectedIndex) {
                    buttons[i].classList.add('incorrect');
                }
            }

            showFeedback(selectedIndex === q.correct, q.options[q.correct]);
        }

        function showFeedback(isCorrect, correctText) {
            feedbackDiv.style.display = 'block';
            if (isCorrect) {
                feedbackDiv.style.backgroundColor = '#d4edda';
                feedbackDiv.style.color = '#155724';
                feedbackDiv.textContent = "¬°Correcto!";
            } else {
                feedbackDiv.style.backgroundColor = '#f8d7da';
                feedbackDiv.style.color = '#721c24';
                feedbackDiv.textContent = `Incorrecto. La respuesta correcta es: ${correctText}`;
            }
        }

        function nextQuestion() {
            if (currentQuestionIndex < questions.length - 1) {
                currentQuestionIndex++;
                loadQuestion(currentQuestionIndex);
            }
        }

        function prevQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                loadQuestion(currentQuestionIndex);
            }
        }

        function updateLiveScore() {
            liveScoreSpan.textContent = `Aciertos: ${score}`;
        }

        function finishQuiz() {
            quizScreen.style.display = 'none';
            resultsScreen.style.display = 'block';
            generateReport();
        }

        function generateReport() {
            const percentage = ((score / questions.length) * 100).toFixed(1);
            document.getElementById('final-score').textContent = percentage;
            document.getElementById('final-stats').textContent = `${score} de ${questions.length} respuestas correctas`;

            const reportDiv = document.getElementById('detailed-report');
            let html = `<table>
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Pregunta</th>
                        <th>Tu Respuesta</th>
                        <th>Estado</th>
                    </tr>
                </thead>
                <tbody>`;
            
            questions.forEach((q, i) => {
                const userIndex = userResponses[i];
                const isCorrect = userIndex === q.correct;
                const userText = userIndex !== null ? q.options[userIndex] : "Sin responder";
                const statusClass = isCorrect ? "status-ok" : "status-bad";
                const statusText = isCorrect ? "CORRECTO" : `INCORRECTO (Era: ${q.options[q.correct]})`;

                html += `<tr>
                    <td>${i + 1}</td>
                    <td>${q.q.substring(0, 50)}...</td>
                    <td>${userText}</td>
                    <td class="${statusClass}">${statusText}</td>
                </tr>`;
            });

            html += `</tbody></table>`;
            reportDiv.innerHTML = html;
        }

        function resetQuiz() {
            if(confirm("¬øEst√°s seguro de que quieres reiniciar el examen? Se perder√° todo el progreso.")) {
                currentQuestionIndex = 0;
                score = 0;
                userResponses.fill(null);
                updateLiveScore();
                resultsScreen.style.display = 'none';
                quizScreen.style.display = 'flex';
                loadQuestion(0);
            }
        }

        // Iniciar
        loadQuestion(0);
    </script>
</body>
</html>